<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@stephen-shopopop/node-metrics</title><meta name="description" content="Documentation for @stephen-shopopop/node-metrics"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@stephen-shopopop/node-metrics</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@stephen-shopopop/node-metrics</h1></div><div class="tsd-panel tsd-typography"><h1 id="node-metrics" class="tsd-anchor-link">node-metrics<a href="#node-metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://badge.fury.io/js/%40stephen-shopopop%2Fnode-metrics"><img src="https://badge.fury.io/js/%40stephen-shopopop%2Fnode-metrics.svg" alt="npm version"></a>
<a href="https://opensource.org/licenses/ISC"><img src="https://img.shields.io/badge/License-ISC-blue.svg" alt="License: ISC"></a>
<a href="https://nodejs.org/"><img src="https://img.shields.io/badge/node-%3E%3D20.17-brightgreen.svg" alt="Node.js"></a></p>
<blockquote>
<p>🚀 Process load measuring plugin for Node.js with automatic &quot;Service Unavailable&quot; handling</p>
</blockquote>
<p>A lightweight, production-ready middleware for monitoring Node.js application health and automatically handling server overload situations. Integrates seamlessly with popular frameworks (Koa, Express, Hono) and provides Prometheus-compatible metrics.</p>
<h2 id="✨-features" class="tsd-anchor-link">✨ Features<a href="#✨-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li>🎯 <strong>Automatic Overload Protection</strong> - Returns HTTP 503 when system is under pressure</li>
<li>📊 <strong>Real-time Metrics</strong> - Monitor event loop delay, heap usage, RSS, and event loop utilization</li>
<li>🔌 <strong>Framework Support</strong> - Works with Koa, Express, Hono, and vanilla Node.js</li>
<li>📈 <strong>Prometheus Integration</strong> - Built-in metrics endpoint and dashboard</li>
<li>⚡ <strong>Low Overhead</strong> - Uses <code>setTimeout</code> instead of <code>setInterval</code> to minimize system pressure</li>
<li>🎨 <strong>Web Dashboard</strong> - Beautiful UI to visualize metrics in real-time</li>
</ul>
<h2 id="📦-installation" class="tsd-anchor-link">📦 Installation<a href="#📦-installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="shell"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@stephen-shopopop/node-metrics</span>
</code><button type="button">Copy</button></pre>

<h2 id="🚀-quick-start" class="tsd-anchor-link">🚀 Quick Start<a href="#🚀-quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="koa" class="tsd-anchor-link">Koa<a href="#koa" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="js"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Koa</span><span class="hl-1"> = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&#39;koa&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-4">underPressureKoaMiddleware</span><span class="hl-1"> } = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&#39;@stephen-shopopop/node-metrics&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Koa</span><span class="hl-1">();</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-0">underPressureKoaMiddleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">appName:</span><span class="hl-1"> </span><span class="hl-2">&#39;service-order&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopDelay:</span><span class="hl-1"> </span><span class="hl-6">1000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxHeapUsedBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxRssBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopUtilization:</span><span class="hl-1"> </span><span class="hl-6">0.98</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryAfter:</span><span class="hl-1"> </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">webServerMetricsPort:</span><span class="hl-1"> </span><span class="hl-6">9090</span><br/><span class="hl-1">}));</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-5">ctx</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">ctx</span><span class="hl-1">.</span><span class="hl-5">body</span><span class="hl-1"> = </span><span class="hl-2">&#39;Hello World&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-6">3000</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<h3 id="express" class="tsd-anchor-link">Express<a href="#express" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="js"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">express</span><span class="hl-1"> = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&#39;express&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-4">underPressureExpressMiddleware</span><span class="hl-1"> } = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&#39;@stephen-shopopop/node-metrics&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1"> = </span><span class="hl-0">express</span><span class="hl-1">();</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">port</span><span class="hl-1"> = </span><span class="hl-6">3000</span><span class="hl-1">;</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-0">underPressureExpressMiddleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">appName:</span><span class="hl-1"> </span><span class="hl-2">&#39;service-order&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopDelay:</span><span class="hl-1"> </span><span class="hl-6">1000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxHeapUsedBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxRssBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopUtilization:</span><span class="hl-1"> </span><span class="hl-6">0.98</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryAfter:</span><span class="hl-1"> </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">webServerMetricsPort:</span><span class="hl-1"> </span><span class="hl-6">9090</span><br/><span class="hl-1">}));</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">, (</span><span class="hl-5">req</span><span class="hl-1">, </span><span class="hl-5">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&#39;Hello World!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-5">port</span><span class="hl-1">, () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Example app listening on port </span><span class="hl-3">${</span><span class="hl-5">port</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="hono" class="tsd-anchor-link">Hono<a href="#hono" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="js"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">Hono</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-2">&#39;hono&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">underPressureHonoMiddleware</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@stephen-shopopop/node-metrics&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Hono</span><span class="hl-1">();</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-2">&#39;*&#39;</span><span class="hl-1">, </span><span class="hl-0">underPressureHonoMiddleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">appName:</span><span class="hl-1"> </span><span class="hl-2">&#39;service-order&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopDelay:</span><span class="hl-1"> </span><span class="hl-6">1000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxHeapUsedBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxRssBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopUtilization:</span><span class="hl-1"> </span><span class="hl-6">0.98</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">retryAfter:</span><span class="hl-1"> </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">webServerMetricsPort:</span><span class="hl-1"> </span><span class="hl-6">9090</span><br/><span class="hl-1">}));</span><br/><br/><span class="hl-5">app</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&#39;/&#39;</span><span class="hl-1">, (</span><span class="hl-5">c</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-5">c</span><span class="hl-1">.</span><span class="hl-0">text</span><span class="hl-1">(</span><span class="hl-2">&#39;Hello Hono!&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-7">export</span><span class="hl-1"> </span><span class="hl-7">default</span><span class="hl-1"> </span><span class="hl-5">app</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<h3 id="manual-integration-vanilla-nodejs" class="tsd-anchor-link">Manual Integration (Vanilla Node.js)<a href="#manual-integration-vanilla-nodejs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="js"><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">createServer</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">Metrics</span><span class="hl-1">, </span><span class="hl-5">isUnderPressure</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@stephen-shopopop/node-metrics&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">metrics</span><span class="hl-1"> = </span><span class="hl-5">Metrics</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">appName:</span><span class="hl-1"> </span><span class="hl-2">&#39;service-order&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">sampleIntervalInMs:</span><span class="hl-1"> </span><span class="hl-6">1000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">resolution:</span><span class="hl-1"> </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">webServerMetricsPort:</span><span class="hl-1"> </span><span class="hl-6">9090</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">options</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopDelay:</span><span class="hl-1"> </span><span class="hl-6">1000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxHeapUsedBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxRssBytes:</span><span class="hl-1"> </span><span class="hl-6">100000000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxEventLoopUtilization:</span><span class="hl-1"> </span><span class="hl-6">0.98</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">hostname</span><span class="hl-1"> = </span><span class="hl-2">&#39;127.0.0.1&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">port</span><span class="hl-1"> = </span><span class="hl-6">3000</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">server</span><span class="hl-1"> = </span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-5">req</span><span class="hl-1">, </span><span class="hl-5">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">if</span><span class="hl-1"> (</span><span class="hl-0">isUnderPressure</span><span class="hl-1">({ ...</span><span class="hl-5">options</span><span class="hl-1">, ...</span><span class="hl-5">metrics</span><span class="hl-1">.</span><span class="hl-0">measures</span><span class="hl-1">() })) {</span><br/><span class="hl-1">    </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-5">statusCode</span><span class="hl-1"> = </span><span class="hl-6">503</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-0">setHeader</span><span class="hl-1">(</span><span class="hl-2">&#39;Retry-After&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;10&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;Service Unavailable&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-5">statusCode</span><span class="hl-1"> = </span><span class="hl-6">200</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-0">setHeader</span><span class="hl-1">(</span><span class="hl-2">&#39;Content-Type&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;text/plain&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;Hello World&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">server</span><span class="hl-1">.</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-5">port</span><span class="hl-1">, </span><span class="hl-5">hostname</span><span class="hl-1">, () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Server running at http://</span><span class="hl-3">${</span><span class="hl-5">hostname</span><span class="hl-3">}</span><span class="hl-2">:</span><span class="hl-3">${</span><span class="hl-5">port</span><span class="hl-3">}</span><span class="hl-2">/`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="standalone-metrics-setup" class="tsd-anchor-link">Standalone Metrics Setup<a href="#standalone-metrics-setup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can set up metrics separately and preload them when starting your application:</p>
<pre><code class="ts"><span class="hl-8">// file: metrics.js</span><br/><span class="hl-7">import</span><span class="hl-1"> { </span><span class="hl-5">Metrics</span><span class="hl-1"> } </span><span class="hl-7">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@stephen-shopopop/node-metrics&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">metrics</span><span class="hl-1"> = </span><span class="hl-5">Metrics</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">({ </span><br/><span class="hl-1">  </span><span class="hl-5">webServerMetricsPort:</span><span class="hl-1"> </span><span class="hl-6">9090</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-5">appName:</span><span class="hl-1"> </span><span class="hl-2">&#39;service-test&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;SIGTERM&#39;</span><span class="hl-1">, () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">metrics</span><br/><span class="hl-1">    .</span><span class="hl-0">closeWebServerMetrics</span><span class="hl-1">()</span><br/><span class="hl-1">    .</span><span class="hl-0">then</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Metrics terminated&#39;</span><span class="hl-1">))</span><br/><span class="hl-1">    .</span><span class="hl-0">catch</span><span class="hl-1">((</span><span class="hl-5">error</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Error terminating metrics&#39;</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">))</span><br/><span class="hl-1">    .</span><span class="hl-0">finally</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-0">exit</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">));</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Run your application with metrics preloaded:</strong></p>
<pre><code class="shell"><span class="hl-0">node</span><span class="hl-1"> </span><span class="hl-3">-r</span><span class="hl-1"> </span><span class="hl-2">./metrics.js</span><span class="hl-1"> </span><span class="hl-2">app.js</span>
</code><button type="button">Copy</button></pre>

<h2 id="⚙️-configuration-options" class="tsd-anchor-link">⚙️ Configuration Options<a href="#⚙️-configuration-options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><table>
<thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>appName</code></td>
<td><code>string</code></td>
<td>-</td>
<td><strong>Required</strong>. Application name (format: <code>service-name</code>)</td>
</tr>
<tr>
<td><code>sampleIntervalInMs</code></td>
<td><code>number</code></td>
<td><code>1000</code></td>
<td>Interval in milliseconds for metrics collection</td>
</tr>
<tr>
<td><code>resolution</code></td>
<td><code>number</code></td>
<td><code>10</code></td>
<td>Resolution/granularity of collected metrics</td>
</tr>
<tr>
<td><code>webServerMetricsPort</code></td>
<td><code>number</code></td>
<td>-</td>
<td>Port for Prometheus metrics server (recommended: <code>9090</code>)</td>
</tr>
<tr>
<td><code>maxEventLoopDelay</code></td>
<td><code>number</code></td>
<td>-</td>
<td>Maximum allowed event loop delay (ms)</td>
</tr>
<tr>
<td><code>maxEventLoopUtilization</code></td>
<td><code>number</code></td>
<td>-</td>
<td>Maximum event loop utilization (0-1, e.g., <code>0.98</code> = 98%)</td>
</tr>
<tr>
<td><code>maxHeapUsedBytes</code></td>
<td><code>number</code></td>
<td>-</td>
<td>Maximum heap memory usage in bytes</td>
</tr>
<tr>
<td><code>maxRssBytes</code></td>
<td><code>number</code></td>
<td>-</td>
<td>Maximum Resident Set Size in bytes</td>
</tr>
<tr>
<td><code>retryAfter</code></td>
<td><code>number</code></td>
<td>-</td>
<td>Seconds to wait before retrying (sent in <code>Retry-After</code> header)</td>
</tr>
</tbody>
</table>
<h3 id="example-configuration" class="tsd-anchor-link">Example Configuration<a href="#example-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="js"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">appName</span><span class="hl-1">: </span><span class="hl-2">&#39;service-order&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">sampleIntervalInMs</span><span class="hl-1">: </span><span class="hl-6">1000</span><span class="hl-1">,        </span><span class="hl-8">// Collect metrics every second</span><br/><span class="hl-1">  </span><span class="hl-9">resolution</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,                   </span><span class="hl-8">// Keep last 10 samples</span><br/><span class="hl-1">  </span><span class="hl-9">maxEventLoopDelay</span><span class="hl-1">: </span><span class="hl-6">1000</span><span class="hl-1">,         </span><span class="hl-8">// Alert if event loop delay &gt; 1000ms</span><br/><span class="hl-1">  </span><span class="hl-9">maxEventLoopUtilization</span><span class="hl-1">: </span><span class="hl-6">0.98</span><span class="hl-1">,   </span><span class="hl-8">// Alert if event loop &gt; 98% utilized</span><br/><span class="hl-1">  </span><span class="hl-9">maxHeapUsedBytes</span><span class="hl-1">: </span><span class="hl-6">100000000</span><span class="hl-1">,     </span><span class="hl-8">// Alert if heap &gt; 100MB</span><br/><span class="hl-1">  </span><span class="hl-9">maxRssBytes</span><span class="hl-1">: </span><span class="hl-6">100000000</span><span class="hl-1">,          </span><span class="hl-8">// Alert if RSS &gt; 100MB</span><br/><span class="hl-1">  </span><span class="hl-9">retryAfter</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,                  </span><span class="hl-8">// Tell clients to retry after 10s</span><br/><span class="hl-1">  </span><span class="hl-9">webServerMetricsPort</span><span class="hl-1">: </span><span class="hl-6">9090</span><span class="hl-1">       </span><span class="hl-8">// Serve metrics on port 9090</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h2 id="📊-monitoring--metrics" class="tsd-anchor-link">📊 Monitoring &amp; Metrics<a href="#📊-monitoring--metrics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="dashboard-ui" class="tsd-anchor-link">Dashboard UI<a href="#dashboard-ui" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Access the beautiful real-time dashboard at:</p>
<pre><code><span class="hl-9">http</span><span class="hl-1">:</span><span class="hl-8">//127.0.0.1:9090</span>
</code><button>Copy</button></pre>

<p><img src="media/nodejs-metrics-dashboard.png" alt="Dashboard UI"></p>
<h3 id="prometheus-metrics-endpoint" class="tsd-anchor-link">Prometheus Metrics Endpoint<a href="#prometheus-metrics-endpoint" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Metrics are exposed in Prometheus format at:</p>
<pre><code><span class="hl-9">http</span><span class="hl-1">:</span><span class="hl-8">//127.0.0.1:9090/metrics</span>
</code><button>Copy</button></pre>

<p><strong>Available Metrics:</strong></p>
<pre><code class="txt"># HELP nodejs_event_loop_delay_milliseconds The mean of the recorded event loop delays
# TYPE nodejs_event_loop_delay_milliseconds gauge
nodejs_event_loop_delay_milliseconds{service=&quot;service-order&quot;} 0.9878575824175826

# HELP nodejs_event_loop_utilized The percentage of event loop utilization
# TYPE nodejs_event_loop_utilized gauge
nodejs_event_loop_utilized{service=&quot;service-order&quot;} 0.10445105761836926

# HELP nodejs_heap_used_bytes The amount of memory used by the V8 heap
# TYPE nodejs_heap_used_bytes gauge
nodejs_heap_used_bytes{service=&quot;service-order&quot;} 32637488

# HELP nodejs_heap_total_bytes The total size of the V8 heap
# TYPE nodejs_heap_total_bytes gauge
nodejs_heap_total_bytes{service=&quot;service-order&quot;} 34684928

# HELP nodejs_rss_bytes The resident set size, or total memory allocated for the process
# TYPE nodejs_rss_bytes gauge
nodejs_rss_bytes{service=&quot;service-order&quot;} 179077120

# HELP nodejs_process_start_time_seconds The process start time, represented in seconds since the Unix epoch
# TYPE nodejs_process_start_time_seconds gauge
nodejs_process_start_time_seconds{service=&quot;service-order&quot;} 1750345329

# HELP nodejs_process_cpu_user_seconds_total The total user CPU time consumed by the process, in seconds
# TYPE nodejs_process_cpu_user_seconds_total counter
nodejs_process_cpu_user_seconds_total{service=&quot;service-order&quot;} 1.494779

# HELP nodejs_process_cpu_system_seconds_total The total system CPU time consumed by the process, in seconds
# TYPE nodejs_process_cpu_system_seconds_total counter
nodejs_process_cpu_system_seconds_total{service=&quot;service-order&quot;} 0.120983

# HELP nodejs_process_cpu_seconds_total The total CPU time (user + system) consumed by the process, in seconds
# TYPE nodejs_process_cpu_seconds_total counter
nodejs_process_cpu_seconds_total{service=&quot;service-order&quot;} 1.615762

# HELP nodejs_active_handles Number of active libuv handles grouped by handle type
# TYPE nodejs_active_handles gauge
nodejs_active_handles{service=&quot;service-order&quot;,type=&quot;WriteStream&quot;} 2
nodejs_active_handles{service=&quot;service-order&quot;,type=&quot;ReadStream&quot;} 1
nodejs_active_handles{service=&quot;service-order&quot;,type=&quot;Server&quot;} 1
nodejs_active_handles{service=&quot;service-order&quot;,type=&quot;Socket&quot;} 1
</code><button type="button">Copy</button></pre>

<h2 id="🔍-how-it-works" class="tsd-anchor-link">🔍 How It Works<a href="#🔍-how-it-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="settimeout-vs-setinterval" class="tsd-anchor-link">setTimeout vs setInterval<a href="#settimeout-vs-setinterval" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Under the hood, <code>node-metrics</code> uses <code>setTimeout</code> to perform polling checks instead of <code>setInterval</code>. This design choice is intentional to avoid adding additional pressure to an already stressed system.</p>
<p><strong>Why setTimeout?</strong></p>
<ul>
<li><strong><code>setInterval</code></strong> calls repeatedly at scheduled intervals regardless of whether the previous call completed, potentially piling up calls when the server is under load</li>
<li><strong><code>setTimeout</code></strong> is called only once and reschedules itself after completion, preventing call accumulation</li>
<li>This ensures the monitoring itself doesn't contribute to system overload</li>
</ul>
<p><strong>Note:</strong> The two methods are not identical in behavior. The timer function is not guaranteed to run at the exact same rate when the system is under pressure or running long processes, but this trade-off is acceptable for health monitoring purposes.</p>
<h3 id="architecture-flow" class="tsd-anchor-link">Architecture Flow<a href="#architecture-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code><span class="hl-1">┌─────────────────────────────────────────────────────────────────────────┐</span><br/><span class="hl-1">│                          </span><span class="hl-4">APPLICATION</span><span class="hl-1"> </span><span class="hl-4">LAYER</span><span class="hl-1">                               │</span><br/><span class="hl-1">│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐              │</span><br/><span class="hl-1">│  │     </span><span class="hl-5">Koa</span><span class="hl-1">      │    │   </span><span class="hl-5">Express</span><span class="hl-1">    │    │     </span><span class="hl-5">Hono</span><span class="hl-1">     │              │</span><br/><span class="hl-1">│  │  </span><span class="hl-5">Application</span><span class="hl-1"> │    │  </span><span class="hl-5">Application</span><span class="hl-1"> │    │  </span><span class="hl-5">Application</span><span class="hl-1"> │              │</span><br/><span class="hl-1">│  └──────┬───────┘    └──────┬───────┘    └──────┬───────┘              │</span><br/><span class="hl-1">│         │                   │                   │                       │</span><br/><span class="hl-1">│         └───────────────────┴───────────────────┘                       │</span><br/><span class="hl-1">│                             │                                           │</span><br/><span class="hl-1">│              ┌──────────────▼──────────────┐                            │</span><br/><span class="hl-1">│              │   </span><span class="hl-5">Middleware</span><span class="hl-1"> </span><span class="hl-5">Integration</span><span class="hl-1">    │                            │</span><br/><span class="hl-1">│              │  </span><span class="hl-5">underPressure</span><span class="hl-1">*</span><span class="hl-0">Middleware</span><span class="hl-1">() │                            │</span><br/><span class="hl-1">│              └──────────────┬──────────────┘                            │</span><br/><span class="hl-1">└─────────────────────────────┼──────────────────────────────────────────┘</span><br/><span class="hl-1">                              │</span><br/><span class="hl-1">┌─────────────────────────────▼──────────────────────────────────────────┐</span><br/><span class="hl-1">│                           </span><span class="hl-4">CORE</span><span class="hl-1"> </span><span class="hl-4">LAYER</span><span class="hl-1">                                    │</span><br/><span class="hl-1">│                                                                         │</span><br/><span class="hl-1">│  ┌──────────────────────────────────────────────────────────┐          │</span><br/><span class="hl-1">│  │              </span><span class="hl-0">Metrics</span><span class="hl-1"> (</span><span class="hl-5">Singleton</span><span class="hl-1">)                          │          │</span><br/><span class="hl-1">│  │  ┌────────────────────────────────────────────────────┐  │          │</span><br/><span class="hl-1">│  │  │  </span><span class="hl-0">start</span><span class="hl-1">()  │  </span><span class="hl-0">register</span><span class="hl-1">()  │  </span><span class="hl-0">measures</span><span class="hl-1">()  │ </span><span class="hl-0">destroy</span><span class="hl-1">()│  │          │</span><br/><span class="hl-1">│  │  └────────────────────────────────────────────────────┘  │          │</span><br/><span class="hl-1">│  │                                                            │          │</span><br/><span class="hl-1">│  │  ┌─────────────┐      ┌──────────────┐                   │          │</span><br/><span class="hl-1">│  │  │   </span><span class="hl-5">Timer</span><span class="hl-1">     │──────▶│   </span><span class="hl-5">Mediator</span><span class="hl-1">   │                  │          │</span><br/><span class="hl-1">│  │  │(</span><span class="hl-5">setTimeout</span><span class="hl-1">) │      │  (</span><span class="hl-5">Plugins</span><span class="hl-1">)   │                   │          │</span><br/><span class="hl-1">│  │  └─────────────┘      └──────┬───────┘                   │          │</span><br/><span class="hl-1">│  │                              │                            │          │</span><br/><span class="hl-1">│  │  ┌───────────────────────────▼────────────────────────┐  │          │</span><br/><span class="hl-1">│  │  │            </span><span class="hl-0">StoreBuilder</span><span class="hl-1"> (</span><span class="hl-5">Metrics</span><span class="hl-1"> </span><span class="hl-5">Storage</span><span class="hl-1">)          │  │          │</span><br/><span class="hl-1">│  │  └───────────────────────────┬────────────────────────┘  │          │</span><br/><span class="hl-1">│  │                              │                            │          │</span><br/><span class="hl-1">│  │  ┌───────────────────────────▼────────────────────────┐  │          │</span><br/><span class="hl-1">│  │  │         </span><span class="hl-0">BroadcastChannel</span><span class="hl-1"> (</span><span class="hl-5">Pub</span><span class="hl-1">/</span><span class="hl-5">Sub</span><span class="hl-1">)                 │  │          │</span><br/><span class="hl-1">│  │  └────────────────────────────────────────────────────┘  │          │</span><br/><span class="hl-1">│  └──────────────────────────────────────────────────────────┘          │</span><br/><span class="hl-1">│                              │                                          │</span><br/><span class="hl-1">│  ┌───────────────────────────▼──────────────────────────────────────┐  │</span><br/><span class="hl-1">│  │                    </span><span class="hl-5">Metrics</span><span class="hl-1"> </span><span class="hl-5">Server</span><span class="hl-1">                                 │  │</span><br/><span class="hl-1">│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │  │</span><br/><span class="hl-1">│  │  │  </span><span class="hl-4">GET</span><span class="hl-1"> /       │  │ </span><span class="hl-4">GET</span><span class="hl-1"> /</span><span class="hl-5">metrics</span><span class="hl-1"> │  │ </span><span class="hl-4">GET</span><span class="hl-1"> /</span><span class="hl-5">metrics</span><span class="hl-1">-</span><span class="hl-5">stream</span><span class="hl-1">  │   │  │</span><br/><span class="hl-1">│  │  │  </span><span class="hl-5">Dashboard</span><span class="hl-1">   │  │  </span><span class="hl-5">Prometheus</span><span class="hl-1">  │  │    </span><span class="hl-4">SSE</span><span class="hl-1"> </span><span class="hl-5">Stream</span><span class="hl-1">        │   │  │</span><br/><span class="hl-1">│  │  └──────────────┘  └──────────────┘  └──────────────────────┘   │  │</span><br/><span class="hl-1">│  └───────────────────────────────────────────────────────────────────┘  │</span><br/><span class="hl-1">└─────────────────────────────────────────────────────────────────────────┘</span><br/><span class="hl-1">                              │</span><br/><span class="hl-1">┌─────────────────────────────▼──────────────────────────────────────────┐</span><br/><span class="hl-1">│                         </span><span class="hl-4">PLUGIN</span><span class="hl-1"> </span><span class="hl-4">LAYER</span><span class="hl-1">                                    │</span><br/><span class="hl-1">│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────────┐     │</span><br/><span class="hl-1">│  │   </span><span class="hl-5">Memory</span><span class="hl-1">     │  │  </span><span class="hl-5">Event</span><span class="hl-1"> </span><span class="hl-5">Loop</span><span class="hl-1">  │  │   </span><span class="hl-5">Event</span><span class="hl-1"> </span><span class="hl-5">Loop</span><span class="hl-1">             │     │</span><br/><span class="hl-1">│  │   </span><span class="hl-5">Usage</span><span class="hl-1">      │  │    </span><span class="hl-5">Delay</span><span class="hl-1">     │  │   </span><span class="hl-5">Utilization</span><span class="hl-1">            │     │</span><br/><span class="hl-1">│  └──────────────┘  └──────────────┘  └──────────────────────────┘     │</span><br/><span class="hl-1">│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────────┐     │</span><br/><span class="hl-1">│  │  </span><span class="hl-5">Process</span><span class="hl-1"> </span><span class="hl-4">CPU</span><span class="hl-1"> │  │   </span><span class="hl-5">Process</span><span class="hl-1">    │  │   </span><span class="hl-5">Active</span><span class="hl-1"> </span><span class="hl-5">Handles</span><span class="hl-1">/        │     │</span><br/><span class="hl-1">│  │    </span><span class="hl-5">Usage</span><span class="hl-1">     │  │   </span><span class="hl-5">Uptime</span><span class="hl-1">     │  │   </span><span class="hl-5">Resources</span><span class="hl-1">              │     │</span><br/><span class="hl-1">│  └──────────────┘  └──────────────┘  └──────────────────────────┘     │</span><br/><span class="hl-1">└─────────────────────────────────────────────────────────────────────────┘</span><br/><br/><br/><span class="hl-1">📊 </span><span class="hl-5">Request</span><span class="hl-1"> </span><span class="hl-5">Flow</span><span class="hl-1"> </span><span class="hl-7">with</span><span class="hl-1"> </span><span class="hl-5">Pressure</span><span class="hl-1"> </span><span class="hl-9">Detection</span><span class="hl-1">:</span><br/><br/><span class="hl-1">  ┌─────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-4">HTTP</span><span class="hl-1">       │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Request</span><span class="hl-1">    │</span><br/><span class="hl-1">  └──────┬──────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────┐</span><br/><span class="hl-1">  │   </span><span class="hl-5">Middleware</span><span class="hl-1">     │</span><br/><span class="hl-1">  │   </span><span class="hl-5">Check</span><span class="hl-1">          │</span><br/><span class="hl-1">  └──────┬───────────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-0">measures</span><span class="hl-1">()      │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Get</span><span class="hl-1"> </span><span class="hl-5">current</span><span class="hl-1">     │</span><br/><span class="hl-1">  │  </span><span class="hl-5">metrics</span><span class="hl-1">         │</span><br/><span class="hl-1">  └──────┬───────────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-0">isUnderPressure</span><span class="hl-1">()           │</span><br/><span class="hl-1">  │  ┌────────────────────────┐  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-5">Event</span><span class="hl-1"> </span><span class="hl-5">Loop</span><span class="hl-1"> </span><span class="hl-5">Delay</span><span class="hl-1"> &gt; </span><span class="hl-5">max</span><span class="hl-1">?│  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-5">Heap</span><span class="hl-1"> </span><span class="hl-5">Usage</span><span class="hl-1"> &gt; </span><span class="hl-5">max</span><span class="hl-1">?      │  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-4">RSS</span><span class="hl-1"> </span><span class="hl-5">Memory</span><span class="hl-1"> &gt; </span><span class="hl-5">max</span><span class="hl-1">?      │  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-4">EL</span><span class="hl-1"> </span><span class="hl-5">Utilization</span><span class="hl-1"> &gt; </span><span class="hl-5">max</span><span class="hl-1">?  │  │</span><br/><span class="hl-1">  │  └────────────────────────┘  │</span><br/><span class="hl-1">  └──────┬─────────────┬─────────┘</span><br/><span class="hl-1">         │             │</span><br/><span class="hl-1">    </span><span class="hl-5">Yes</span><span class="hl-1">  │             │  </span><span class="hl-5">No</span><br/><span class="hl-1">         ▼             ▼</span><br/><span class="hl-1">  ┌─────────────┐  ┌──────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-5">Return</span><span class="hl-1"> </span><span class="hl-6">503</span><span class="hl-1"> │  │  </span><span class="hl-5">Continue</span><span class="hl-1"> </span><span class="hl-5">to</span><span class="hl-1"> │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Service</span><span class="hl-1">    │  │  </span><span class="hl-0">next</span><span class="hl-1">()      │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Unavailable</span><span class="hl-1">│  │              │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Retry</span><span class="hl-1">-</span><span class="hl-5">After</span><span class="hl-1">│  │              │</span><br/><span class="hl-1">  └─────────────┘  └──────────────┘</span><br/><br/><br/><span class="hl-1">⏱️  </span><span class="hl-5">Periodic</span><span class="hl-1"> </span><span class="hl-5">Metrics</span><span class="hl-1"> </span><span class="hl-0">Collection</span><span class="hl-1"> (</span><span class="hl-5">Every</span><span class="hl-1"> </span><span class="hl-5">sampleIntervalInMs</span><span class="hl-1">):</span><br/><br/><span class="hl-1">  ┌──────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-5">setTimeout</span><span class="hl-1">  │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Trigger</span><span class="hl-1">     │</span><br/><span class="hl-1">  └──────┬───────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-5">Mediator</span><span class="hl-1">        │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Iterate</span><span class="hl-1"> </span><span class="hl-5">Plugins</span><span class="hl-1"> │</span><br/><span class="hl-1">  └──────┬───────────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────────────────────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-5">Each</span><span class="hl-1"> </span><span class="hl-5">Plugin</span><span class="hl-1">.</span><span class="hl-0">capture</span><span class="hl-1">(</span><span class="hl-5">StoreBuilder</span><span class="hl-1">)       │</span><br/><span class="hl-1">  │  ┌────────────────────────────────────┐  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-5">MemoryUsagePlugin</span><span class="hl-1">                  │  │</span><br/><span class="hl-1">  │  │   → </span><span class="hl-5">heap_used_bytes</span><span class="hl-1">                │  │</span><br/><span class="hl-1">  │  │   → </span><span class="hl-5">rss_bytes</span><span class="hl-1">                      │  │</span><br/><span class="hl-1">  │  ├────────────────────────────────────┤  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-5">EventLoopDelayPlugin</span><span class="hl-1">               │  │</span><br/><span class="hl-1">  │  │   → </span><span class="hl-5">event_loop_delay_milliseconds</span><span class="hl-1">  │  │</span><br/><span class="hl-1">  │  ├────────────────────────────────────┤  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-5">EventLoopUtilizationPlugin</span><span class="hl-1">         │  │</span><br/><span class="hl-1">  │  │   → </span><span class="hl-5">event_loop_utilized</span><span class="hl-1">            │  │</span><br/><span class="hl-1">  │  ├────────────────────────────────────┤  │</span><br/><span class="hl-1">  │  │ </span><span class="hl-5">ProcessCpuUsagePlugin</span><span class="hl-1">              │  │</span><br/><span class="hl-1">  │  │   → </span><span class="hl-5">process_cpu_</span><span class="hl-1">*</span><span class="hl-5">_seconds_total</span><span class="hl-1">    │  │</span><br/><span class="hl-1">  │  └────────────────────────────────────┘  │</span><br/><span class="hl-1">  └──────┬───────────────────────────────────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-5">StoreBuilder</span><span class="hl-1">    │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Update</span><span class="hl-1"> </span><span class="hl-5">Metrics</span><span class="hl-1">  │</span><br/><span class="hl-1">  └──────┬───────────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────┐</span><br/><span class="hl-1">  │ </span><span class="hl-5">BroadcastChannel</span><span class="hl-1"> │</span><br/><span class="hl-1">  │ </span><span class="hl-5">Publish</span><span class="hl-1"> </span><span class="hl-5">Update</span><span class="hl-1">   │</span><br/><span class="hl-1">  └──────────────────┘</span><br/><span class="hl-1">         │</span><br/><span class="hl-1">         ▼</span><br/><span class="hl-1">  ┌──────────────────────────────┐</span><br/><span class="hl-1">  │  </span><span class="hl-0">Subscribers</span><span class="hl-1"> (</span><span class="hl-5">Dashboard</span><span class="hl-1">,     │</span><br/><span class="hl-1">  │  </span><span class="hl-5">Metrics</span><span class="hl-1"> </span><span class="hl-5">Stream</span><span class="hl-1">, </span><span class="hl-5">etc</span><span class="hl-1">.)       │</span><br/><span class="hl-1">  └──────────────────────────────┘</span>
</code><button>Copy</button></pre>

<h2 id="📚-documentation" class="tsd-anchor-link">📚 Documentation<a href="#📚-documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For detailed API documentation and advanced usage:</p>
<ul>
<li><a href="https://stephen-shopopop.github.io/node-metrics/"><strong>Full Documentation</strong></a></li>
</ul>
<h2 id="🤝-contributing" class="tsd-anchor-link">🤝 Contributing<a href="#🤝-contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Contributions are welcome! Please feel free to submit a Pull Request.</p>
<h2 id="📝-license" class="tsd-anchor-link">📝 License<a href="#📝-license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="LICENSE">ISC</a> © <a href="https://github.com/stephen-shopopop">Stephen Deletang</a></p>
<h2 id="🔗-links" class="tsd-anchor-link">🔗 Links<a href="#🔗-links" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><a href="https://github.com/stephen-shopopop/node-metrics">GitHub Repository</a></li>
<li><a href="https://www.npmjs.com/package/@stephen-shopopop/node-metrics">npm Package</a></li>
<li><a href="https://github.com/stephen-shopopop/node-metrics/issues">Issue Tracker</a></li>
<li><a href="https://stephen-shopopop.github.io/node-metrics/">Documentation</a></li>
</ul>
<hr>
<p>Made with ❤️ by <a href="https://github.com/stephen-shopopop">Stephen Deletang</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#node-metrics"><span>node-<wbr/>metrics</span></a><ul><li><a href="#✨-features"><span>✨ <wbr/>Features</span></a></li><li><a href="#📦-installation"><span>📦 <wbr/>Installation</span></a></li><li><a href="#🚀-quick-start"><span>🚀 <wbr/>Quick <wbr/>Start</span></a></li><li><ul><li><a href="#koa"><span>Koa</span></a></li><li><a href="#express"><span>Express</span></a></li><li><a href="#hono"><span>Hono</span></a></li><li><a href="#manual-integration-vanilla-nodejs"><span>Manual <wbr/>Integration (<wbr/>Vanilla <wbr/>Node.js)</span></a></li><li><a href="#standalone-metrics-setup"><span>Standalone <wbr/>Metrics <wbr/>Setup</span></a></li></ul></li><li><a href="#⚙️-configuration-options"><span>⚙️ <wbr/>Configuration <wbr/>Options</span></a></li><li><ul><li><a href="#example-configuration"><span>Example <wbr/>Configuration</span></a></li></ul></li><li><a href="#📊-monitoring--metrics"><span>📊 <wbr/>Monitoring &amp; <wbr/>Metrics</span></a></li><li><ul><li><a href="#dashboard-ui"><span>Dashboard <wbr/>UI</span></a></li><li><a href="#prometheus-metrics-endpoint"><span>Prometheus <wbr/>Metrics <wbr/>Endpoint</span></a></li></ul></li><li><a href="#🔍-how-it-works"><span>🔍 <wbr/>How <wbr/>It <wbr/>Works</span></a></li><li><ul><li><a href="#settimeout-vs-setinterval"><span>set<wbr/>Timeout vs set<wbr/>Interval</span></a></li><li><a href="#architecture-flow"><span>Architecture <wbr/>Flow</span></a></li></ul></li><li><a href="#📚-documentation"><span>📚 <wbr/>Documentation</span></a></li><li><a href="#🤝-contributing"><span>🤝 <wbr/>Contributing</span></a></li><li><a href="#📝-license"><span>📝 <wbr/>License</span></a></li><li><a href="#🔗-links"><span>🔗 <wbr/>Links</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@stephen-shopopop/node-metrics</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
